# 选股策略治理配置（Champion / Challenger）

strategy_governance:
  # 当前执行层冠军策略（线上唯一）
  active_champion_id: regime_ma_strategy
  champion_source: manual
  manual_effective_date: "2026-02-18"
  manual_reason: "Regime模型Sharpe 2.20 > seed_balance，回撤-8.4%更优"

  # 影子运行策略
  challengers:
    - seed_balance_strategy
    - balance_strategy_v1
    - positive_strategy_v1
    - value_strategy_v1
    - satellite_strategy_v1

# 自动晋升（Champion/Challenger）配置
auto_promotion:
  enabled: true
  allow_when_manual: false
  evaluation_path: config/app/shadow_eval.json
  decision_path: data/backtest/governance/promotion_decisions.jsonl
  consecutive_periods: 3
  max_drawdown_tolerance: 0.02
  max_turnover_multiplier: 1.2
  min_cost_return_diff: 0.0
  min_sharpe_diff: 0.0
  min_data_quality: 0.95

# 自动降级（Champion回退基线）配置
auto_downgrade:
  enabled: false
  evaluation_path: config/app/shadow_eval.json
  lookback_periods: 3
  thresholds:
    max_drawdown_limit: -0.15
    min_sharpe: 0.0
    max_turnover: 2.0
    consecutive_loss_periods: 3
    min_cost_return: -0.05

# 挑战者正向策略（positive）的组合权重
challenger_weights:
  positive_growth_weight: 0.7
  positive_frontier_weight: 0.3
  satellite_growth_weight: 0.35
  satellite_frontier_weight: 0.25
  satellite_rps_weight: 0.20
  satellite_elasticity_weight: 0.10
  satellite_not_priced_weight: 0.10

# Regime MA Strategy 配置（新Champion）
# 训练：宏观级别regime标签（人工划分bull/bear/neutral）
# 推理：MA20/MA60均线判断regime，选择对应专家模型
# 特征：扩展7因子（RSI、MA斜率、成交量趋势、动量加速度、行业超额、市值/换手率百分位）
# 过滤：排除ST/*ST + 北交所(.BJ)
regime_ma_strategy:
  model_type: lgbm
  label_horizons: [10, 20]
  label_weights: [0.4, 0.6]
  risk_adjusted: true
  industry_col: industry_l1
  label_neutralized: true
  ic_filter_enabled: true
  ic_threshold: 0.015
  ic_ir_threshold: 0.2
  ic_hit_rate_threshold: 0.50
  exclude_bj: true
  exclude_st: true
  lgbm_params:
    objective: regression
    metric: rmse
    learning_rate: 0.02
    num_leaves: 31
    max_depth: 6
    min_data_in_leaf: 200
    feature_fraction: 0.6
    bagging_fraction: 0.6
    bagging_freq: 5
    lambda_l1: 1.0
    lambda_l2: 5.0
    min_gain_to_split: 0.01
    num_boost_round: 500
    early_stopping_rounds: 50
    verbosity: -1
  regime_overrides:
    bear:
      min_data_in_leaf: 300
      lambda_l2: 8.0

# Seed Balance Strategy 默认模型配置（原Champion，现Challenger）
seed_balance_strategy:
  model_type: lgbm
  # P1: 多周期标签（降噪）
  label_horizons: [5, 10, 20]      # 短中长期组合
  label_weights: [0.2, 0.3, 0.5]   # 加权平均
  risk_adjusted: true
  industry_col: industry_l1
  industry_rank: true
  rank_mode: industry
  # P0: 行业中性化标签（防过拟合核心）
  label_neutralized: true          # 标签 = 个股收益 - 行业平均收益
  market_neutralized: false
  # P0: LightGBM 正则化参数
  lgbm_params:
    objective: lambdarank
    metric: ndcg
    learning_rate: 0.02            # ↓ 降低学习率
    num_leaves: 15                 # ↓ 降低复杂度
    max_depth: 4                   # ↓ 限制树深
    min_data_in_leaf: 500          # ↑ 防过拟合核心
    feature_fraction: 0.6          # ↓ 特征采样
    bagging_fraction: 0.6          # ↓ 数据采样
    bagging_freq: 5
    lambda_l1: 1.0                 # L1 正则
    lambda_l2: 10.0                # L2 正则
    min_gain_to_split: 0.01
    num_boost_round: 500           # ↑ 增加轮数
    early_stopping_rounds: 50      # 早停
    verbosity: -1

# 行业信号契约对齐配置（run_weekly 自动按 trade_date 构建）
industry_signals:
  default_lookback_days: 30
  default_half_life_days: 7.0
  signal_lookback_days:
    policy_score: 3
    concept_bias: 7
    northbound_ratio: 45
  signal_half_life_days:
    policy_score: 5
    concept_bias: 5
    northbound_ratio: 7
  overlay:
    overlay_strength: 0.20
    mainline_strength: 0.35
    tilt_strength: 0.0
    signal_weights:
      policy_score: 0.4
      concept_bias: 0.3
      northbound_ratio: 0.3
    regime_overrides:
      bull:
        overlay_strength: 0.25
        mainline_strength: 0.50
        tilt_strength: 0.08
        signal_weights:
          policy_score: 0.25
          concept_bias: 0.55
          northbound_ratio: 0.20
        industry_tilts:
          电子: 0.35
          计算机: 0.35
          通信: 0.30
          机械设备: 0.20
          汽车: 0.15
      sideways:
        overlay_strength: 0.20
        mainline_strength: 0.35
        tilt_strength: 0.05
        signal_weights:
          policy_score: 0.45
          concept_bias: 0.20
          northbound_ratio: 0.35
        industry_tilts:
          医药生物: 0.25
          食品饮料: 0.20
          公用事业: 0.20
          银行: 0.15
      bear:
        overlay_strength: 0.15
        mainline_strength: 0.20
        tilt_strength: 0.10
        signal_weights:
          policy_score: 0.50
          concept_bias: 0.10
          northbound_ratio: 0.40
        industry_tilts:
          医药生物: 0.45
          公用事业: 0.40
          银行: 0.30
          煤炭: 0.20
          电子: -0.35
          计算机: -0.40
