integrity_exclude:
  - opt_daily
  - tushare_anns
  - tushare_reports
  - ggt_daily

tasks:
  ths_index:
    api: ths_index
    mode: single
    output: "concepts/ths_index.parquet"

  ths_daily:
    api: ths_daily
    mode: date_range
    start_field: start_date
    end_field: end_date
    split: month
    pagination: offset
    limit: 3000
    dedup_keys: ["ts_code", "trade_date"]
    state: "data/states/ths_daily.json"
    output: "concepts/ths_daily.parquet"
  daily_basic:
    api: daily_basic
    mode: date_range
    start_field: start_date
    end_field: end_date
    split: month
    pagination: offset
    limit: 6000
    dedup_keys: ["ts_code", "trade_date"]
    state: "data/states/daily_basic.json"
    output: "daily_basic.parquet"

  margin:
    api: margin
    mode: date_range
    start_field: start_date
    end_field: end_date
    split: month
    pagination: offset
    limit: 4000
    dedup_keys: ["trade_date", "exchange_id"]
    state: "data/states/margin.json"
    output: "margin.parquet"

  daily_kline:
    api: daily
    mode: date_range
    start_field: start_date
    end_field: end_date
    split: month
    dedup_keys: ["ts_code", "trade_date"]
    state: "data/states/daily_kline.json"
    output: "daily.parquet"

  index_ohlc:
    api: daily
    mode: list
    list_items: ["000300.SH", "000905.SH"]
    list_param: ts_code
    start_field: start_date
    end_field: end_date
    split: month
    dedup_keys: ["ts_code", "trade_date"]
    state: "data/states/index_ohlc.json"
    output: "index/index_ohlc.parquet"

  hs300_constituents:
    api: index_weight
    mode: date_range
    start_field: start_date
    end_field: end_date
    split: year
    params:
      index_code: "000300.SH"
    dedup_keys: ["con_code", "trade_date"]
    state: "data/states/hs300_constituents.json"
    output: "constituents/hs300_constituents_all.parquet"

  hs300_moneyflow:
    api: moneyflow
    mode: list
    list_file: "data/tushare/constituents/hs300_constituents_all.parquet"
    list_column: "con_code"
    list_param: ts_code
    start_field: start_date
    end_field: end_date
    split: month
    dedup_keys: ["ts_code", "trade_date"]
    state: "data/states/hs300_moneyflow.json"
    output: "moneyflow/moneyflow_all.parquet"

  hs300_moneyflow_bydate:
    api: moneyflow
    mode: date_range
    start_field: start_date
    end_field: end_date
    split: month
    pagination: offset
    limit: 5000
    filter_field: ts_code
    filter_list_file: "data/tushare/constituents/hs300_constituents_all.parquet"
    filter_list_column: "con_code"
    skip_coverage_check: true
    dedup_keys: ["ts_code", "trade_date"]
    state: "data/states/hs300_moneyflow_bydate.json"
    output: "moneyflow/moneyflow_all.parquet"

  sw_industry_classify:
    api: index_classify
    mode: single
    params:
      level: "L1"
      src: "SW2021"
    output: "sw_industry/sw_industry_l1.parquet"

  sw_industry_daily:
    api: sw_daily
    mode: date_range
    start_field: start_date
    end_field: end_date
    split: month
    pagination: offset
    limit: 3000
    dedup_keys: ["ts_code", "trade_date"]
    state: "data/states/sw_industry_daily.json"
    output: "sectors/sw_daily_all.parquet"

  sw_index_member:
    api: index_member
    mode: list
    list_file: "data/tushare/sw_industry/sw_industry_l1.parquet"
    list_column: "index_code"
    list_param: index_code
    dedup_keys: ["index_code", "con_code"]
    state: "data/states/sw_index_member.json"
    output: "sw_industry/sw_index_member.parquet"

  opt_daily:
    api: opt_daily
    mode: list
    list_items: ["SSE", "SZSE"]
    list_param: exchange
    start_field: trade_date
    end_field: trade_date
    split: day
    params:
      calender: "natural"
    dedup_keys: ["ts_code", "trade_date", "exchange"]
    state: "data/states/opt_daily.json"
    output: "options/opt_daily.parquet"

  fina_indicator:
    api: fina_indicator_vip
    mode: date_range
    start_field: start_date
    end_field: end_date
    split: quarter
    pagination: offset
    limit: 5000
    dedup_keys: ["ts_code", "end_date", "update_flag"]
    state: "data/states/fina_indicator.json"
    output: "fina_indicator/fina_indicator_all.parquet"

  fina_indicator_vip:
    api: fina_indicator_vip
    mode: year_quarters
    list_param: period
    start_year: 2016
    end_year: 2026
    quarters: ["0331", "0630", "0930", "1231"]
    state: "data/states/fina_indicator_vip.json"
    output: "fina_indicator_vip/fina_indicator_vip_all.parquet"
    output_aliases:
      - "fina_indicator/fina_indicator_all.parquet"

  ths_member:
    api: ths_member
    mode: list
    list_file: "data/tushare/concepts/ths_index.parquet"
    list_column: "ts_code"
    list_param: ts_code
    state: "data/states/ths_member.json"
    output: "concepts/ths_member.parquet"

  northbound_flow:
    api: moneyflow_hsgt
    mode: date_range
    start_field: start_date
    end_field: end_date
    split: month
    dedup_keys: ["trade_date"]
    state: "data/states/northbound_flow.json"
    output: "northbound/northbound_flow.parquet"

  northbound_hold:
    api: hk_hold
    mode: date_range
    start_field: start_date
    end_field: end_date
    split: month
    dedup_keys: ["ts_code", "trade_date"]
    state: "data/states/northbound_hold.json"
    output: "northbound/northbound_hold.parquet"

  northbound_top10:
    api: hsgt_top10
    mode: date_range
    start_field: start_date
    end_field: end_date
    split: month
    pagination: offset
    limit: 5000
    dedup_keys: ["trade_date", "ts_code"]
    state: "data/states/northbound_top10.json"
    output: "northbound/northbound_top10.parquet"

  yield_10y:
    api: yc_cb
    mode: single
    pagination: offset
    limit: 2000
    params:
      curve_term: 10
    dedup_keys: ["trade_date", "curve_term"]
    state: "data/states/yield_10y.json"
    output: "macro/yield_10y.parquet"

  yield_2y:
    api: yc_cb
    mode: single
    pagination: offset
    limit: 2000
    params:
      curve_term: 2
    dedup_keys: ["trade_date", "curve_term"]
    state: "data/states/yield_2y.json"
    output: "macro/yield_2y.parquet"

  cn_cpi:
    api: cn_cpi
    mode: date_range
    date_format: "%Y%m"
    start_field: start_m
    end_field: end_m
    split: month
    dedup_keys: ["month"]
    state: "data/states/cn_cpi.json"
    output: "macro/tushare_cpi.parquet"

  cn_ppi:
    api: cn_ppi
    mode: date_range
    date_format: "%Y%m"
    start_field: start_m
    end_field: end_m
    split: month
    dedup_keys: ["month"]
    note: "全国PPI主口径（替代NBS nbs_ppi_national）"
    state: "data/states/cn_ppi.json"
    output: "macro/tushare_ppi.parquet"

  cn_pmi:
    api: cn_pmi
    mode: date_range
    date_format: "%Y%m"
    start_field: start_m
    end_field: end_m
    split: month
    dedup_keys: ["month"]
    state: "data/states/cn_pmi.json"
    output: "macro/tushare_pmi.parquet"

  sw_valuation:
    api: sw_daily
    mode: date_range
    start_field: start_date
    end_field: end_date
    split: month
    pagination: offset
    limit: 3000
    dedup_keys: ["trade_date", "ts_code"]
    state: "data/states/sw_valuation.json"
    output: "macro/sw_valuation.parquet"

  fina_mainbz_vip:
    api: fina_mainbz_vip
    mode: year_quarters
    list_param: period
    start_year: 2016
    end_year: 2026
    quarters: ["0331", "0630", "0930", "1231"]
    pagination: offset
    limit: 8000
    dedup_keys: ["ts_code", "end_date", "bz_item", "bz_code"]
    state: "data/states/fina_mainbz_vip.json"
    output: "macro/segments/fina_mainbz_vip.parquet"
    output_aliases:
      - "macro/segments/fina_mainbz_all.parquet"

  tushare_anns:
    api: anns_d
    mode: date_range
    start_field: start_date
    end_field: end_date
    split: month
    pagination: offset
    limit: 2000
    dedup_keys: ["ann_date", "ts_code", "title", "url"]
    state: "data/states/tushare_anns.json"
    output: "policy/tushare_anns.parquet"

  tushare_reports:
    api: research_report
    mode: date_range
    start_field: start_date
    end_field: end_date
    split: month
    pagination: offset
    limit: 1000
    dedup_keys: ["trade_date", "title", "ts_code", "inst_csname"]
    state: "data/states/tushare_reports.json"
    output: "policy/tushare_reports.parquet"

  income:
    api: income_vip
    mode: year_quarters
    list_param: period
    start_year: 2016
    end_year: 2026
    quarters: ["0331", "0630", "0930", "1231"]
    dedup_keys: ["ts_code", "end_date", "report_type"]
    state: "data/states/income.json"
    output: "fundamental/income/income_all.parquet"

  balancesheet:
    api: balancesheet_vip
    mode: year_quarters
    list_param: period
    start_year: 2016
    end_year: 2026
    quarters: ["0331", "0630", "0930", "1231"]
    dedup_keys: ["ts_code", "end_date", "report_type"]
    state: "data/states/balancesheet.json"
    output: "fundamental/balancesheet/balancesheet_all.parquet"

  cashflow:
    api: cashflow_vip
    mode: year_quarters
    list_param: period
    start_year: 2016
    end_year: 2026
    quarters: ["0331", "0630", "0930", "1231"]
    dedup_keys: ["ts_code", "end_date", "report_type"]
    state: "data/states/cashflow.json"
    output: "fundamental/cashflow/cashflow_all.parquet"

  dividend:
    api: dividend
    mode: date_range
    start_field: ann_date
    end_field: ann_date
    split: year
    dedup_keys: ["ts_code", "end_date", "div_proc"]
    state: "data/states/dividend.json"
    output: "fundamental/dividend/dividend_all.parquet"

  # P1 高 Alpha 因子数据（分析师预期）
  forecast:
    api: forecast_vip
    mode: date_range
    start_field: ann_date
    end_field: ann_date
    split: quarter
    pagination: offset
    limit: 5000
    dedup_keys: ["ts_code", "ann_date", "end_date"]
    state: "data/states/forecast.json"
    output: "fundamental/forecast/forecast_all.parquet"

  express:
    api: express
    mode: year_quarters
    list_param: period
    start_year: 2016
    end_year: 2026
    quarters: ["0331", "0630", "0930", "1231"]
    dedup_keys: ["ts_code", "end_date"]
    state: "data/states/express.json"
    output: "fundamental/express/express_all.parquet"

  # P1 高 Alpha 因子数据（港股通交易）
  ggt_daily:
    api: ggt_daily
    mode: date_range
    start_field: start_date
    end_field: end_date
    split: month
    dedup_keys: ["trade_date", "ts_code"]
    state: "data/states/ggt_daily.json"
    output: "northbound/ggt_daily.parquet"

  # P2 高 Alpha 因子数据（个股融资融券明细）
  margin_detail:
    api: margin_detail
    mode: date_range
    start_field: start_date
    end_field: end_date
    split: month
    pagination: offset
    limit: 6000
    dedup_keys: ["trade_date", "ts_code"]
    state: "data/states/margin_detail.json"
    output: "margin_detail/margin_detail_all.parquet"
