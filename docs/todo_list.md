# 待完成事项清单

## 1. 趋势模型不够完美

### 问题描述
当前趋势模型（HMM模型）在识别市场状态方面存在不足，需要进一步优化。

### 具体问题
- 模型参数优化不够充分
- 状态识别准确率有待提高
- 对极端市场行情的适应性不足
- 标签系统的鲁棒性需要加强

### 改进方向
- **参数优化**: 使用网格搜索或贝叶斯优化寻找最佳参数组合
- **特征工程**: 增加更多技术指标和市场特征
- **模型融合**: 尝试HMM与其他模型（LSTM、Transformer）的混合方法
- **标签系统**: 优化标签生成逻辑，提高标签质量
- **回测验证**: 在更长时间周期上进行回测，验证模型稳定性

### 相关文件
- `scripts/strategy/mainline_logic_system_optimized.py`
- `docs/市场状态打标系统总结.md`

---

## 2. 选股模型概念数据获取受限制，没有实现

### 问题描述
选股模型需要使用概念板块数据，但由于Tushare IP限制和积分不足，无法获取完整的概念数据。

### 当前状态
- **Tushare概念接口**: 879个概念，但只下载了100个（IP限制）
- **东方财富概念接口**: 5000个概念，需要6000积分（当前5100积分）
- **同花顺概念接口**: 需要更高积分

### 遇到的问题
- **IP限制**: Tushare账号触发IP数量超限（最大2个），需要等待30分钟-1小时
- **积分不足**: 东方财富和同花顺接口需要6000+积分
- **数据更新**: 概念成分股需要定期更新，当前缺乏增量更新机制

### 解决方案
- **短期方案**:
  - 等待IP限制解除，下载Tushare所有879个概念的成分股
  - 使用现有100个概念数据试跑验证逻辑
- **中期方案**:
  - 增加Tushare积分到6000+，使用东方财富接口
  - 实现每周增量更新机制（base + n个周期增量）
- **长期方案**:
  - 建立概念数据自动更新系统
  - 定期检查概念成分股变化

### 待完成任务
- [ ] 等待IP限制解除，下载所有879个Tushare概念成分股
- [ ] 实现2024-09-24到2024-12-31期间活跃概念分析
- [ ] 如果效果好，考虑使用东方财富的5000个概念
- [ ] 建立每周更新概念列表和成分股的机制
- [ ] 实现base概念 + n个周期增量概念的合并逻辑

### 相关文件
- `scripts/data/tushare_downloader.py`（`--task tushare_concept_list`/`tushare_concept_detail`）
- `data/raw/tushare/sectors/all_concept_details.csv` (100个概念)

---

## 3. 买卖点模型没有实现建模和测试

### 问题描述
买卖点模型是量化交易系统的核心组件，目前尚未实现。

### 功能需求
- **买入点识别**: 在牛市主线逻辑确认后，选择合适的买入时机
- **卖出点识别**: 设置止盈止损点，及时止盈止损
- **仓位管理**: 根据市场状态调整仓位
- **风险控制**: 防止大额亏损

### 技术方案
- **买入信号**:
  - 技术指标突破（均线、MACD、RSI等）
  - 成交量放大确认
  - 板块领涨强度确认
  - 个股基本面确认
- **卖出信号**:
  - 技术指标背离
  - 板块主线切换
  - 止盈/止损触发
  - 市场状态恶化
- **仓位管理**:
  - 熊市：10%仓位
  - 震荡市：30%仓位
  - 牛市：满仓/分批调仓

### 待完成任务
- [ ] 设计买卖点识别指标体系
- [ ] 实现买入点识别模型
- [ ] 实现卖出点识别模型
- [ ] 实现仓位管理策略
- [ ] 进行历史回测验证
- [ ] 实现风险控制机制

### 相关文件
- `sage_core/strategy/signal_generator.py` (待实现)
- `sage_core/portfolio/risk_manager.py` (待实现)

---

## 4. 国家统计局数据的整理和清洗

### 问题描述
国家统计局数据包含宏观经济指标，对市场趋势预测具有重要参考价值，需要整理和清洗后才能使用。

### 数据类型
- **GDP数据**: 季度GDP、分行业GDP
- **CPI数据**: 居民消费价格指数
- **PPI数据**: 工业生产者出厂价格指数
- **PMI数据**: 采购经理指数
- **工业增加值**: 分行业工业增加值
- **固定资产投资**: 分行业投资数据
- **社会消费品零售总额**: 分品类零售数据
- **货币供应量**: M0、M1、M2
- **利率数据**: LPR、SHIBOR等

### 数据来源
- 国家统计局官网：http://www.stats.gov.cn/
- Tushare接口：`macro_*` 系列接口

### 待完成任务
- [ ] 调研Tushare宏观接口，确定可用数据范围
- [ ] 下载2020-2026年宏观经济数据
- [ ] 数据清洗：处理缺失值、异常值
- [ ] 数据标准化：统一时间频率（月度/季度）
- [ ] 特征工程：计算同比增长率、环比增长率
- [ ] 数据可视化：生成宏观经济指标趋势图
- [ ] 关联分析：分析宏观指标与股市的关系
- [ ] 建立宏观指标数据库

### 技术方案
- **数据获取**:
  - 使用Tushare `macro_*` 系列接口
  - 国家统计局官网爬虫（备用方案）
- **数据清洗**:
  - 处理缺失值：插值或删除
  - 处理异常值：统计方法识别并修正
  - 统一时间频率：低频数据上采样，高频数据下采样
- **特征工程**:
  - 计算同比增长率
  - 计算环比增长率
  - 计算移动平均
  - 计算差分项
- **数据存储**:
  - 使用Parquet格式存储
  - 按类型分表存储
  - 建立索引优化查询

### 预期成果
- 完整的宏观经济数据库
- 清洗后的时间序列数据
- 宏观指标与股市的相关性分析报告
- 可用于趋势预测的宏观特征

### 相关文件
- `data/raw/tushare/macro/` (待创建)
- `scripts/data/macro/fetch_macro_data.py` (待实现)
- `scripts/data/macro/clean_macro_data.py` (待完善)

---

## 实施计划

### 阶段一：国家统计局数据整理和清洗（当前优先）
1. 调研Tushare宏观接口
2. 下载宏观经济数据
3. 数据清洗和特征工程
4. 建立宏观指标数据库

### 阶段二：趋势模型优化
1. 参数优化和特征工程
2. 模型融合
3. 回测验证

### 阶段三：概念数据完善
1. 等待IP限制解除
2. 下载所有概念成分股
3. 实现增量更新机制

### 阶段四：买卖点模型实现
1. 设计买卖点指标体系
2. 实现买入卖出模型
3. 仓位管理和风险控制
4. 回测验证

---

## 备注

- 当前优先级：国家统计局数据整理和清洗
- 概念数据受Tushare IP限制影响，需要等待或增加积分
- 买卖点模型依赖趋势模型和选股模型的完善
