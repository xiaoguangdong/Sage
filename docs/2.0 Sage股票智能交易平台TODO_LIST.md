# Sage股票智能交易平台 TODO LIST

> 本TODO基于**现有代码与最终设计**整理，先给出“已实现/部分/未实现”清单，再列出待办。

## 0. 现状清单（基于当前仓库）
### 已实现（雏形/基础）
- 宏观/北向/NBS 数据拉取脚本：`scripts/data/macro/*`
- 趋势/排序/买卖点模型雏形：`sage_core/models/*`
- 主线与行业轮动原型脚本：`scripts/strategy/mainline_logic_system*.py`
- Walk-forward 回测框架（收益计算已接入真实价格）

### 部分实现（有代码但未闭环）
- 数据源适配器：仅 Tushare/Baostock（NBS/Eastmoney/Akshare 未接入）
- 宏观模型：MacroPredictor/IndustryClassifier/CycleDetector 已有，但未对齐行业映射与T+2
- 趋势模型：规则版存在，但缺置信度/仓位与bug修复
- 排序/买卖点：模型有，未完成端到端训练与融合

### 未实现（按设计必做）
- 统一字段规范（`ts_code`/`trade_date`）
- 信号契约与输出落地
- 交易成本/滑点/T+1/T+2 在回测中落地
- 异步任务调度（APScheduler）与推送落地

---

## P0 代码健康与数据规范（立即）
- [x] 统一股票代码字段（`ts_code`/`code`/`stock`）与日期字段（`trade_date`/`date`）
- [x] 修复 `run_weekly.py` 与 `DataLoader.load_all_baostock_data()` 接口不匹配
- [x] 修复 `features/price_features.py`、`features/market_features.py` 的语法/API问题
- [x] 修复 `trend_model.py`（`ma_medium` 赋值）与 `trend_model_enhanced.py` 的逻辑问题
- [x] 回测中移除随机收益占位，接入真实收益计算
- [x] 建立数据质量检查脚本与报告模板
- [x] 统一日志规范：`logs/<module>/<YYYYMMDD>_<NNN>.log`
- [x] 新增“防数据泄露检查”（标签列/未来信息过滤）

### 数据源适配器（细分）
- [x] Tushare/Baostock 接口存在（`sage_app/data/data_provider.py`）
- [x] NBS/Tushare 宏观脚本存在（`scripts/data/macro/*`）
- [ ] Eastmoney 接入
- [ ] Akshare 接入

---

## P1 核心研究链路（短期）
### 宏观模型对齐
- [x] MacroPredictor/IndustryClassifier/CycleDetector 代码存在
- [x] 对齐 NBS → 申万映射（口径统一）
- [x] 行业口径统一（industry/sw_industry/industry_name）
- [x] 输出行业覆盖率审计报告（缺失行业清单）
- [x] 生成申万一级行业聚合特征（industry_features_sw_l1）
- [x] 行业景气度：个股信号聚合到申万一级
- [x] 北向行业配置比例落地（industry_northbound_flow）
- [x] T+2 延迟落地
- [x] 三大宏观信号导出到 `data/signals/`

### 趋势状态模型
- [x] 规则模型雏形存在
- [ ] 修复 bug
- [ ] 增加 `confidence/position_suggestion`
- [ ] 输出落地

### 主线与行业轮动
- [x] 主线脚本存在
- [ ] 与信号融合对接

### 选股排序 + 买卖点
- [x] 排序模型/买卖点模型存在
- [ ] LGBM vs XGBoost 对比训练
- [ ] 与规则选股对照
- [ ] 与融合层闭环

### 信号契约
- [ ] 统一 Signal Schema（宏观/趋势/主线/排序/过滤）
- [ ] `data/signals/` 输出落地

### LLM 模块
- [ ] 政策/产业/概念 LLM 模块设计与数据管道（细节后定，只做加权/过滤）

---

## P2 回测与评估（中期）
- [ ] Walk-forward/滚动回测一体化
- [ ] 交易成本/滑点/复权框架（已确认默认滑点）
- [ ] T+1 卖出限制 & T+2 数据延迟入回测
- [ ] 评价指标：年化/回撤/IC/IR/胜率/换手率

---

## P3 监控与报告（中期）
- [ ] 数据缺失/异常监控
- [ ] 数据完整性巡检（国债收益率2Y/10Y、PMI等）
- [ ] 日报/周报模板
- [ ] 回测报告输出（markdown + csv）
- [x] 异步任务模块：趋势信号定时导出（APScheduler）
- [ ] 异步任务模块：定时入库、推送与告警（APScheduler）

---

## P4 重构与扩展（长期）
- [ ] 模块插件化（策略/模型可替换）
- [ ] 预留实盘接口（模拟盘优先）
- [ ] LLM/NLP模块接入（政策/产业/概念信号，输出结构化标签）

---

## Q&A
- Q: 是否保留/迁移 `ml_stock_forecast` 作为旧版基线？  
  A: 已拆分为 `sage_core/`（核心）与 `sage_app/`（非核心管线），历史说明移至 `docs/legacy/ml_stock_forecast/`。
- Q: 低频调仓目标是“周/双周/月”？  
  A: 周频调仓（已确认）。
