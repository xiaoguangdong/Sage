# Sage股票智能交易平台 TODO LIST

> **最后更新**：2026-02-18（基于全面代码扫描）
> **项目完成度**：约80%（18,279行Python代码）
> **目标**：工程上高质量 + 功能上高收益低回撤

## 📊 实现状态总览

| 模块 | 完成度 | 状态 |
|------|--------|------|
| 核心选股系统 | 95% | ✅ 完整可用 |
| 趋势模型 | 90% | ✅ 规则版完整，HMM部分实现 |
| 组合管理 | 100% | ✅ 完整实现 |
| 执行系统 | 80% | ⚠️ 框架完整，实盘未测试 |
| 回测系统 | 85% | ✅ Walk-Forward完整，成本模型简化 |
| 数据管道 | 70% | ⚠️ 基础完整，自动化不足 |
| 监控治理 | 60% | ⚠️ 基础完整，告警缺失 |
| 文档 | 75% | ⚠️ 设计文档完整，API文档缺失 |

## 0. 现状清单（基于2026-02-18全面扫描）

### ✅ 已完成（完整可用）
- **核心选股系统**：StockSelector/RegimeStockSelector/MultiAlphaStockSelector 完整实现
  - 30+因子特征工程、IC筛选防过拟合、分Regime训练
  - **回测结果**：Regime模型+80.69% vs 单一模型+61.60% vs 沪深300+44.88%
- **趋势模型**：TrendModelRuleV2 完整实现
  - 三层架构、状态机、熔断机制、波动率自适应、多时间框架确认
- **组合管理**：PortfolioManager + RiskControl 完整实现
  - 长线70%+短线30%、行业分散、流动性过滤、回撤控制
- **回测系统**：WalkForwardEvaluator 完整实现
  - Purge/Embargo防过拟合、分组回测、IC计算
- **治理系统**：StrategyGovernance 完整实现
  - Champion/Challenger框架、自动晋升决策
  - **当前Champion**：regime_ma（Sharpe 2.20）
- **执行系统**：OrderLifecycle + BrokerAdapter + UnifiedSignalContract 框架完整
- **数据系统**：DataCatalog + Tushare下载 + 数据完整性检查

### ⚠️ 部分实现（有代码但不完整）
- **特征系统**：FeaturePipeline框架完整，但高级特征未实现
  - SatelliteFeatures/FlowFeatures/LongTermFundamentalFeatures 仅占位符
- **行业分析**：IndustryBacktestEval 完整，但与选股集成不完整
  - CycleDetector/MacroPredictor 仅占位符
- **宏观模型**：数据处理脚本存在（scripts/data/macro/），但未集成到sage_core/
- **监控系统**：数据质量检查完整，但缺乏实时仪表板和告警

### ❌ 未实现（需要开发）
- **买卖点模型**：EntryModel 仅占位符，无实际实现
- **交易成本模型**：仅有单边成本率，缺乏滑点和市场冲击
- **风控体系**：confidence动态仓位未接入回测、缺乏ATR止损
- **自动化调度**：配置存在，但DAG调度逻辑不完整
- **因子体系**：缺乏分析师预期因子、机构行为因子、因子监控体系
- **归因分析**：缺乏Brinson归因、因子收益归因、风险模型

---

## 🔴 P0 优先级（立即处理）

### 1. 买卖点模型（关键缺失）
- [ ] **EntryModel 实现**：当前仅占位符
  - [ ] 买入点识别逻辑（技术指标突破确认）
  - [ ] 卖出点识别逻辑（止盈/止损/趋势反转）
  - [ ] 标签生成完整实现
  - [ ] 与选股模型集成
  - [ ] 回测验证

### 2. 交易成本模型（回测准确性）
- [x] 单边成本率（已实现）
- [ ] **滑点模型**：固定滑点 + 波动率滑点
- [ ] **市场冲击成本**：Almgren-Chriss简化版
- [ ] **买卖价差成本**：基于日内数据或固定比例
- [ ] 成本模型参数配置化（`config/app/backtest_costs.yaml`）
- [ ] 成本敏感性分析报告

### 3. 风控体系补齐（控制回撤）
- [x] 基础止损/止盈（已实现）
- [ ] **接入confidence动态仓位**：趋势模型已输出confidence，回测未接入
  - 公式：`pos = base + (max-base) × confidence`
- [ ] **个股ATR动态止损**：替代固定百分比
- [ ] **行业层面止损**：行业整体回撤超阈值 → 行业清仓
- [ ] **组合层面分档降仓**：
  - -10%: 仓位降至80%
  - -12%: 仓位降至60%
  - -15%: 仓位降至30%
- [ ] **单日冲击止损**：单日跌幅超3%触发降仓
- [ ] 止损事件日志与报告

### 4. 概念数据获取问题（数据完整性）
- [ ] **问题**：Tushare IP限制，同花顺概念数据不完整
- [ ] **解决方案**：
  - [ ] 评估其他数据源（Akshare/Eastmoney）
  - [ ] 实现数据源降级策略
  - [ ] 建立概念数据缓存机制

### 5. 数据补充（进行中）
- [x] 修改tushare_tasks.yaml年份范围（2016-2026）
- [x] 创建通用补充脚本（支持daily/monthly/single）
- [ ] 补充2016-2019年财务数据（进行中，预计30分钟）
- [ ] 补充2016-2019年日线数据（daily_basic、ths_daily等）
- [ ] 补充静态数据（northbound_hold、hs300_constituents等）
- [ ] 运行data_integrity_checker.py验证数据完整性

---

## P0 代码健康与数据规范（已完成）
- [x] 统一股票代码字段（`ts_code`/`code`/`stock`）与日期字段（`trade_date`/`date`）
- [x] 修复 `run_weekly.py` 与 `DataLoader.load_all_baostock_data()` 接口不匹配
- [x] 修复 `features/price_features.py`、`features/market_features.py` 的语法/API问题
- [x] 修复 `trend_model.py`（`ma_medium` 赋值）与 `trend_model_enhanced.py` 的逻辑问题
- [x] 回测中移除随机收益占位，接入真实收益计算
- [x] 建立数据质量检查脚本与报告模板
- [x] 统一日志规范：`logs/<module>/<YYYYMMDD>_<NNN>.log`
- [x] 新增"防数据泄露检查"（标签列/未来信息过滤）
- [x] Tushare 默认数据根统一为 `data/tushare/`（兼容回退 `data/raw/tushare/` 只读）
- [x] 配置分层收敛：应用配置统一到 `config/app/`
- [x] 统一任务编排入口：`scripts/run_job.py`
- [x] `sage_core` 解除对 `scripts/*` 运行时路径的直接依赖

### 数据源适配器
- [x] Tushare/Baostock 接口存在（`sage_app/data/data_provider.py`）
- [x] NBS/Tushare 宏观脚本存在（`scripts/data/macro/*`）
- [x] Eastmoney 行业研报接入（政策行业模块）
- [ ] Eastmoney 其他数据源接入（如财报/事件，待评估）
- [ ] Akshare 接入
- [x] 统一下载入口重构：合并分散脚本到 `scripts/data/tushare_downloader.py`，避免重复脚本
- [x] 完成统一入口后移除 `scripts/data/tushare_suite.py` 旧入口
- [x] Tushare 批量历史补数脚本（`scripts/data/backfill_missing_data.py`）

---

## 🟡 P1 核心研究链路（短期）

### 宏观模型对齐
- [x] MacroPredictor/IndustryClassifier/CycleDetector 代码存在（但仅占位符）
- [x] 对齐 NBS → 申万映射（口径统一）
- [x] 行业口径统一（industry/sw_industry/industry_name）
- [x] 输出行业覆盖率审计报告（缺失行业清单）
- [x] 生成申万一级行业聚合特征（industry_features_sw_l1）
- [x] 行业景气度：个股信号聚合到申万一级
- [x] 北向行业配置比例落地（industry_northbound_flow）
- [x] T+2 延迟落地
- [x] 三大宏观信号导出到 `data/signals/`
- [ ] **宏观模型集成到sage_core/**：当前数据处理在scripts/data/macro/，未集成
- [ ] **实现MacroPredictor**：当前仅占位符
- [ ] **实现CycleDetector**：当前仅占位符

### 趋势状态模型
- [x] **TrendModelRuleV2 完整实现**：三层架构、状态机、熔断机制、波动率自适应
- [x] 增加 `confidence/position_suggestion`
- [x] 输出落地
- [ ] **TrendModelLGBM 实现**：当前仅占位符
- [ ] **TrendModelHMM 优化**：已有框架，但实际使用较少

### 主线与行业轮动
- [x] 主线脚本存在
- [x] 与信号融合对接（`industry_score_snapshot` + `industry_signal_snapshot` 已接入执行层overlay）
- [x] 行业信号新鲜度与覆盖治理（`northbound_ratio` 覆盖与滞后已修复，补齐代理延展与周度巡检）
- [x] P0：分状态行业叠加落地到周流程（`bull/sideways/bear` 支持 `signal_weights + industry_tilts`）
- [x] P0：牛市概念权重网格与硬门槛筛选（`optimize_bull_concept_weight.py`）
- [x] P0：景气评分分状态IC诊断（`diagnose_prosperity_ic_by_state.py`）

#### 主线模型V2（基于豆包方案）拆解
- [ ] V2-总项：门控 + 四维评分 + 动态权重 + A/B回测 + 监控全链路落地
- [ ] V2-0 数据源分层与可用性注册表（免费必备/可选付费/降级策略）
- [ ] V2-1 牛市土壤门控（趋势结构+市场广度+流动性+盈利预期代理）
- [ ] V2-2 四维主线评分引擎（产业/资金/业绩/结构）与行业Top2输出
- [ ] V2-3 四维子指标落地（政策强度、北向与成交、业绩上修代理、结构扩散/Hurst）
- [ ] V2-4 动态权重（IC/IR滚动12M）与静态权重回退
- [ ] V2-5 V2信号契约输出（`mainline_v2_score`, `mainline_v2_topn`, `mainline_v2_diag`）
- [ ] V2-6 A/B回测（V1对比V2，基准沪深300，周频，T+1/T+2约束）
- [ ] V2-7 风险约束联动（行业上限40%、拥挤度降温、趋势门控降仓）
- [ ] V2-8 监控与复盘（维度贡献、行业命中率、漂移告警）
- **预计工作量**：17~24人日（约3~5周，按单人并行度）

### 选股排序 + 买卖点
- [x] **StockSelector 完整实现**：30+因子、IC筛选、三种模型
- [x] **RegimeStockSelector 完整实现**：分市场状态训练，Sharpe 2.20
- [x] **MultiAlphaStockSelector 完整实现**：多策略融合
- [ ] LGBM vs XGBoost 对比训练（已支持，需系统对比）
- [ ] 与规则选股对照
- [ ] 与融合层闭环
- [x] Champion/Challenger 治理核心引擎落地（线上唯一冠军 + 影子挑战者）
- [x] 策略命名与注册：`seed_balance_strategy` / `balance_strategy_v1` / `positive_strategy_v1` / `value_strategy_v1` / `satellite_strategy_v1`
- [x] `multi_alpha_selector.py` 结果拆分为四个 Challenger 并统一输出契约（新增 `satellite_strategy_v1`）
- [x] 执行层治理接口仅读取 `active_champion_id`（在治理引擎层实现）
- [x] 选股统一信号契约（`stock_signal_contract.parquet`）落地
- [x] 执行层组合构建改为只消费统一契约，并接入行业契约叠加（`execution_signals_<date>.parquet`）
- [ ] 手动切换 Champion 配置（`effective_date` + `reason`）与审计日志
- [ ] 晋升门槛与自动降级（回退 `baseline_conservative`）实现与回测验证

### 信号契约
- [x] 统一 Signal Schema（趋势/主线行业/选股）并输出统一契约 `data/signals/contracts/unified_signal_contract_<trade_date>.parquet`
- [x] `data/signals/` 输出落地
- [x] 行业信号统一契约落地（`industry_signal_contract.parquet`）
- [x] 选股信号统一契约落地（`stock_signal_contract.parquet`）
- [x] 行业/主线/选股信号字段收敛与版本化（`signal_name/source/model_version/confidence` 统一口径）

### 分 Regime 训练（已完成）
- [x] 按市场状态分模型训练（RegimeStockSelector，软分配 MoE）
- [x] 推理时用趋势模型判断 Regime 选择模型
- [x] 标签周期优化（120d → 10/20d，对齐调仓频率）
- [x] Early Stopping 修复（独立验证集）
- [x] Walk-Forward 评估框架（Purging + Embargo + 分组回测）
- [x] IC 稳定性过滤（hit_rate ≥ 55%）
- [x] Regime 软分配（样本权重：目标1.0/相邻0.3/对立0.05）
- [x] 回测验证（2024-09 ~ 2026-01）：宏观标签后单一+61.60%, Regime+80.69%, 沪深300+44.88%
- [x] 时间衰减样本加权（指数衰减，半衰期~2年）
- [x] 硬分配训练（每个专家模型只用对应regime数据）
- [x] P6修复：predict_prepared全量预计算特征，消除score坍缩bug
- [x] 固定 random_state (seed=42) 保证 Regime 模型可复现性
- [x] 补充股票名称映射（从 ths_member.parquet 读取，替代不存在的 stock_basic.parquet）
- [x] 宏观Regime标签训练：训练用人工划分的宏观市场阶段（bull/bear/neutral），推理用趋势模型实时判断

### 政策/产业/概念信号模块
- [x] 政府站点抓取（发改委/工信部/国务院/商务部/生态环境部/科技部/证监会/央行/财政部/国资委主站）
- [x] 规则版行业关键词映射 + 基础情绪分数
- [x] 输出 `policy_signals.parquet` 与摘要
- [x] 政策信号回测脚本雏形（行业级→股票池）
- [ ] Tushare 公告接入（暂缓；当前不接，待权限开通后再接）
- [ ] Tushare 研报接口（暂缓；当前不接，待权限/成本条件满足后再接）
- [x] 接入东方财富行业研报并合流
- [x] 输出增强信号（研报热度 + 行业动量）
- [x] 置信度输出（来源权重 + 关键词强度 + 频次）
- [x] 去重策略（同标题/同日/同源重复）
- [x] 行业映射覆盖率统计与修补（东方财富研报 → 申万L1）
- [ ] 研报"头部券商缺失"偏差说明与校准方案
- [x] 来源稳定性增强（source_health + 稳定性加权）
- [x] 国资委主站稳定入口替换移动版

### 概念/板块数据
- [x] 同花顺板块指数接口接入（ths_index / ths_daily）
- [x] 概念热度因子（基于 ths_daily）落地
- [x] ths_daily 按月全量拉取与完整性校验（按月批次 + 断点续传）
- [x] 概念热度接入主线评分正式链路（`industry_concept_bias.parquet` + Mainline优先读取）
- [x] 概念→行业映射覆盖率从 0.8439 提升至 ≥ 0.95（当前 0.9881，保留 high_conf=0.8439）

### 因子体系升级（新增）
- [ ] **分析师预期因子**
  - [ ] 盈利预测修正因子（EPS修正方向与幅度）
  - [ ] 评级变化因子（评级上调/下调）
  - [ ] 一致预期偏离因子（实际 vs 预期）
- [ ] **机构行为因子**
  - [ ] 北向资金细分（配置型 vs 交易型识别）
  - [ ] 公募持仓变动因子（季报持仓变化）
  - [ ] 融资融券因子（融资余额变化）
  - [ ] 大宗交易因子（折价率、成交量）
- [ ] **因子处理优化**
  - [ ] 因子正交化（消除风格共线性）
  - [ ] 市值中性化（当前仅有行业中性化）
  - [ ] 因子衰减分析（不同horizon的IC衰减曲线）
  - [ ] 因子拥挤度监控（因子收益率趋势）
- [ ] **因子监控体系**
  - [ ] 因子IC日报（每日计算并记录）
  - [ ] 因子IC滚动统计（5日/20日/60日均值）
  - [ ] 因子衰减预警（IC连续5日低于阈值触发告警）
  - [ ] 因子贡献归因（每期各因子对收益的贡献）

---

## 🟢 P2 回测与评估（中期）
- [x] Walk-forward/滚动回测一体化（WalkForwardEvaluator完整实现）
- [ ] 交易成本/滑点/复权框架（已确认默认滑点，需完善）
- [x] T+1 卖出限制 & T+2 数据延迟入回测
- [ ] 评价指标：年化/回撤/IC/IR/胜率/换手率（部分实现，需补充Calmar/Sortino）
- [x] 行业回测评估体系补齐（行业命中率、行业超额、行业回撤贡献、换手与成本后收益）脚本：`scripts/strategy/evaluate_industry_backtest.py`

### 归因分析体系（新增）
- [ ] **Brinson归因**：配置效应 + 选股效应 + 交互效应
- [ ] **因子收益归因**：各风险因子贡献
- [ ] **择时/选股收益分解**
- [ ] **风险模型（BARRA风格）**
  - [ ] SIZE / BETA / MOMENTUM / VALUE / VOLATILITY / LIQUIDITY / QUALITY
  - [ ] 行业因子暴露
- [ ] **组合风险分解**：系统性风险 vs 特质风险
- [ ] **周度自动报告生成**
  - [ ] 绩效概览（收益/回撤/夏普）
  - [ ] 归因分析
  - [ ] 因子健康度
  - [ ] 持仓分析
- [ ] **月度深度报告**
  - [ ] 策略表现对比
  - [ ] 风险分析
  - [ ] 市场环境回顾

---

## 🟢 P3 监控与报告（中期）
- [x] 监控模块V1设计文档（覆盖数据/任务/信号/治理/风控/执行预留）
- [ ] 监控模块实现（暂缓；当前仅保留V1设计，后续统一开发）
- [x] 数据缺失/异常监控（check_data_quality.py等）
- [ ] 数据完整性巡检（国债收益率2Y/10Y、PMI等）
- [ ] 日报/周报模板
- [ ] 回测报告输出（markdown + csv）
- [x] 异步任务模块：趋势信号定时导出（APScheduler）
- [x] 异步任务模块：选股月度重训 + 周度信号导出（APScheduler）
- [ ] 异步任务模块：定时入库、推送与告警（APScheduler）
- [ ] 监控模块V1统一入口（`scripts/monitoring/run_monitoring.py`）
- [ ] 监控规则配置化（`config/monitoring/monitoring_rules.yaml`）
- [ ] 统一监控结果契约（PASS/WARN/FAIL + severity + metrics + thresholds）
- [ ] 数据监控纳管（macro/northbound/concepts/industry signals 核心数据集）
- [ ] 任务监控纳管（下载/特征/信号/周流程任务状态与耗时）
- [ ] 信号监控纳管（覆盖率/新鲜度/有效置信度/冲突率）
- [ ] 治理与风控监控纳管（Champion决策完整性、组合约束越界）
- [ ] 监控汇总日报与周报（`reports/monitoring/`）
- [ ] 告警通道预留（短信/webhook，先不启用）

---

## 🔵 P4 重构与扩展（长期）
- [ ] 模块插件化（策略/模型可替换）
- [x] 预留实盘接口入口（平安证券 dry-run stub）
- [x] 订单生命周期状态机契约（NEW/ACK/PARTIAL/FILLED/CANCEL/REJECT）
- [ ] 平安证券实盘下单闭环（鉴权/下单/撤单/回报/持仓对账）
- [ ] 执行审计产物（orders/fills/reconcile）标准化落盘
- [ ] LLM/NLP模块接入（政策/产业/概念信号，输出结构化标签）
- [ ] LSTM 板块超额收益预测（研究型、非主链路）
- [ ] K-means 领涨板块自动识别（研究型、非主链路）
- [ ] LLM 政策语义分析增强（需规则版稳定后接入）

### 执行系统完善（新增）
- [x] 框架完整（OrderLifecycle + BrokerAdapter）
- [ ] **TWAP执行算法**：时间加权平均价格
- [ ] **VWAP执行算法**：成交量加权平均价格
- [ ] **智能拆单**：大单分批执行
- [ ] **盘口深度考虑**：流动性约束
- [ ] **平安证券实盘闭环测试**
  - [ ] 鉴权流程
  - [ ] 下单/撤单
  - [ ] 回报处理
  - [ ] 持仓对账
- [ ] 预留多券商接口（华泰/中信等）
- [ ] 失败重试机制
- [ ] 交易状态追踪看板

### 数据治理升级（新增）
- [x] 数据质量检查脚本（check_data_quality.py等）
- [ ] **复权价格校验脚本**：前后复权一致性
- [ ] **异常值自动清洗**：3σ原则 + 业务规则
- [ ] **数据完整性检查**：断点检测与补数
- [ ] **数据新鲜度监控**：最后更新时间
- [ ] **数据源扩展**
  - [ ] Eastmoney财报数据接入
  - [ ] Eastmoney事件数据接入
  - [ ] Akshare数据源接入评估
  - [ ] 多源数据交叉验证机制
- [ ] **数据架构**
  - [ ] 建立特征库（标准化因子存储）
  - [ ] 建立标签库（多horizon标签）
  - [ ] 建立回测缓存（避免重复计算）
  - [ ] 数据版本管理（支持回溯）

### 工程质量提升（新增）
- [ ] **代码规范**
  - [ ] 添加类型注解（mypy静态检查）
  - [ ] 统一代码风格（black + isort）
  - [ ] 添加pre-commit hooks
  - [ ] 移除 `scripts/legacy/` 历史代码
- [ ] **依赖管理**
  - [ ] 迁移到 `pyproject.toml`
  - [ ] 添加版本锁定（`requirements-lock.txt`）
  - [ ] 清理多余虚拟环境（保留单一开发环境）
- [ ] **日志与监控**
  - [ ] 结构化日志（JSON格式）
  - [ ] 日志聚合（集中到单一目录结构）
  - [ ] 关键指标监控仪表盘（Grafana或自建）
- [ ] **容器化**
  - [ ] 添加 Dockerfile
  - [ ] 添加 docker-compose.yml（开发环境）
  - [ ] 环境变量管理（.env.example 完善）
- [ ] **测试覆盖**
  - [ ] `sage_app/` 模块测试补充（当前仅 `sage_core/tests/`）
  - [ ] 回测引擎端到端测试（模拟完整周期）
  - [ ] 因子计算单元测试（每个因子独立验证）
  - [ ] 添加 CI 自动化测试（GitHub Actions 或本地脚本）

### 持续迭代机制（新增）
- [x] Champion-Challenger框架（已实现）
- [ ] **自动化Challenger评估流程**
- [ ] **晋升门槛量化定义**：IC/IR/回撤综合评分
- [ ] **自动降级机制**：连续N期表现不佳触发
- [ ] **切换审计日志**
- [ ] **A/B测试机制**
  - [ ] 建立策略A/B测试框架
  - [ ] 统计显著性检验（t-test）
  - [ ] 实盘小资金灰度测试流程
- [ ] **文档体系**
  - [ ] 因子字典文档（每个因子定义/计算方式/预期方向）
  - [ ] 策略说明书（投资逻辑/风险点/适用环境）
  - [ ] 运维手册（日常操作/故障处理）

---

## 📋 优先级执行路线图

### Week 1-2: P0 数据与回测正确性
1. [ ] 完成2016-2019历史数据补充（进行中）
2. [ ] 实现完整的交易成本模型（滑点 + 市场冲击）
3. [ ] 验证回测系统无数据泄露（已基本正确，需最终验证）
4. [ ] 解决概念数据获取问题

### Week 3-4: P0 风控体系
5. [ ] 接入confidence动态仓位到回测
6. [ ] 实现个股ATR动态止损
7. [ ] 实现组合层面分档降仓
8. [ ] 实现止损事件日志

### Week 5-6: P0 买卖点模型
9. [ ] 实现EntryModel基础框架
10. [ ] 实现技术指标买卖点识别
11. [ ] 与选股模型集成
12. [ ] 回测验证

### Week 7-8: P1 宏观模型与因子
13. [ ] 集成宏观数据处理到sage_core/
14. [ ] 实现MacroPredictor
15. [ ] 补充分析师预期因子
16. [ ] 实现因子IC监控体系

### Week 9-10: P1 主线模型V2
17. [ ] V2-1 牛市土壤门控
18. [ ] V2-2 四维主线评分引擎
19. [ ] V2-3 四维子指标落地
20. [ ] V2-4 动态权重

### Week 11-12: P2 归因与执行
21. [ ] Brinson归因实现
22. [ ] 因子收益归因
23. [ ] TWAP/VWAP执行算法
24. [ ] 平安证券实盘测试

### 持续: P3 工程质量与监控
25. [ ] 自动化调度框架
26. [ ] 监控和告警系统
27. [ ] 自动化报告生成
28. [ ] 文档完善

---


## 🎯 关键指标目标

| 指标 | 当前状态 | 目标值 | 备注 |
|------|----------|--------|------|
| 年化收益 | - | ≥ 15% | 需长周期回测验证 |
| 最大回撤 | - | ≤ 10% | 需补齐风控体系 |
| 夏普比率 | 2.20 (Regime MA) | ≥ 1.5 | ✅ 已达标 |
| 卡玛比率 | - | ≥ 1.5 | 需计算 |
| 胜率 | - | ≥ 55% | 需统计 |
| 日均换手 | - | ≤ 5% | 需统计 |
| 测试覆盖率 | ~20% | ≥ 60% | 需补充测试 |
| 代码类型注解 | ~80% | ≥ 80% | ✅ 已达标 |

---

## 📚 关键文件清单

### 核心实现（完整可用）
- `sage_core/stock_selection/stock_selector.py` - 选股核心（完整）
- `sage_core/stock_selection/regime_stock_selector.py` - Regime选股（完整，Sharpe 2.20）
- `sage_core/stock_selection/multi_alpha_stock_selector.py` - 多策略融合（完整）
- `sage_core/trend/trend_model.py` - 趋势模型（TrendModelRuleV2完整）
- `sage_core/portfolio/portfolio_manager.py` - 组合管理（完整）
- `sage_core/portfolio/risk_control.py` - 风险控制（完整）
- `sage_core/governance/strategy_governance.py` - 治理框架（完整）
- `sage_core/backtest/walk_forward.py` - Walk-Forward回测（完整）
- `sage_core/backtest/simple_backtest.py` - 简单回测引擎（完整）
- `sage_core/execution/broker_adapter.py` - 券商适配器（框架完整）
- `sage_core/execution/order_lifecycle.py` - 订单生命周期（完整）
- `sage_core/execution/unified_signal_contract.py` - 统一信号契约（完整）

### 占位符（需要实现）
- `sage_core/execution/entry_model.py` - 买卖点模型（仅占位符）
- `sage_core/features/satellite_features.py` - 卫星特征（仅占位符）
- `sage_core/features/flow_features.py` - 资金流特征（仅占位符）
- `sage_core/features/long_term_fundamental_features.py` - 长期基本面特征（仅占位符）
- `sage_core/industry/cycle_detector.py` - 周期检测（仅占位符）
- `sage_core/industry/macro_predictor.py` - 宏观预测（仅占位符）

### 配置
- `config/base.yaml` - 全局配置
- `config/tushare_tasks.yaml` - 下载任务（32个任务）
- `config/app/broker.yaml` - 券商配置
- `config/app/` - 应用层配置目录

### 脚本入口
- `scripts/run_job.py` - 统一任务编排
- `scripts/backtest/backtest_champion_challenger.py` - 回测对比
- `scripts/data/tushare_downloader.py` - 数据下载
- `scripts/data/backfill_missing_data.py` - 历史数据补充（支持daily/monthly/single）
- `scripts/monitoring/check_data_quality.py` - 数据质量检查

---

## 🔄 与旧TODO的主要差异

### ✅ 已完成但旧TODO标记为未完成
- 趋势模型已优化（TrendModelRuleV2完整实现，三层架构+熔断+波动率自适应）
- Regime选股已实现（RegimeStockSelector完整，回测Sharpe 2.20）
- Champion/Challenger框架已实现（StrategyGovernance完整）
- Walk-Forward回测已实现（WalkForwardEvaluator完整，Purge/Embargo防过拟合）
- 防过拟合机制完整（IC筛选、Purge/Embargo、分组回测）
- 信号契约已落地（UnifiedSignalContract完整）

### ❌ 未完成但旧TODO标记为已完成或描述不准确
- 买卖点模型（仅有占位符，无实际实现）
- 宏观模型集成（数据处理存在于scripts/data/macro/，未集成到sage_core/）
- 自动化调度（配置存在，但DAG调度逻辑不完整）
- 趋势模型"缺置信度/仓位"（实际已实现confidence/position_suggestion）
- 排序/买卖点"未完成端到端训练"（实际StockSelector已完整实现）

### 🆕 新发现的问题
- 概念数据获取受限（Tushare IP限制）
- 交易成本模型简化（仅有单边成本率，缺乏滑点和市场冲击）
- 特征系统不完整（Satellite/Flow/LongTermFundamental仅占位符）
- 数据更新机制不完整（缺乏自动化DAG调度）
- 行业模型V2未实现（主线模型V2的四维评分引擎）

---

## 📝 文档维护说明

**重要**：本TODO文档是项目的核心跟踪文档，每次完成任务后必须更新：

1. **任务完成时**：将对应的 `[ ]` 改为 `[x]`
2. **发现新问题时**：添加到对应优先级章节
3. **实现状态变化时**：更新"实现状态总览"表格
4. **每周回顾时**：检查优先级是否需要调整
5. **重大里程碑时**：更新"关键指标目标"表格

**更新频率**：
- 每完成一个P0任务：立即更新
- 每完成一个P1任务：当天更新
- 每周五：全面回顾和调整优先级

---

## Q&A
- Q: 是否保留/迁移 `ml_stock_forecast` 作为旧版基线？
  A: 已拆分为 `sage_core/`（核心）与 `sage_app/`（非核心管线），历史说明移至 `docs/legacy/ml_stock_forecast/`。
- Q: 低频调仓目标是"周/双周/月"？
  A: 周频调仓（已确认）。
- Q: 项目完成度如何？
  A: 约80%，核心选股系统95%完成可直接使用，主要短板是买卖点模型、交易成本模型、自动化调度。

---

**最后更新**：2026-02-18
**更新依据**：全面代码扫描（18,279行Python代码）
**项目完成度**：约80%
**下次更新**：完成P0任务后或每周五
