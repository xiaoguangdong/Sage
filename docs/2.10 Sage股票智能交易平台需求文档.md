# Sage股票智能交易平台需求文档

## 1. 项目目标
建立一套可扩展的智能交易平台，核心目标：
1) 研究/回测为主，服务中线低频策略  
2) 强调风险控制与可复现性  
3) 模块可替换、便于长期迭代  

---

## 2. 适用范围
### 2.1 标的与交易约束
- 资产范围：仅 A 股  
- 股票池：沪深300（**历史成分**）  
- 可包含 A 股 ETF：是（可配置）  
- 交易频率：日频数据、**周频调仓（推荐）**  
- 单只股票预计持有周期：2周～6个月  
- 流动性约束：暂不设（后续参数化配置）  
 - 卖出限制：A股 **T+1**  

### 2.2 策略目标与评价
- 核心目标：**收益/回撤平衡（可配置）**  
- 基准：沪深300  

### 2.3 回测假设
- 交易成本模型：固定千分之5（**单边，含印花税/佣金/过户费**）  
- 滑点模型：与成交额相关（默认平方根冲击模型，可配置）  
- 复权与数据延迟：财报/公告/北向数据按 **T+2** 延迟处理  

**默认滑点模型（平方根冲击）**：
```
ADV = rolling_mean(amount, 20日)
participation = trade_value / ADV
slippage_bps = half_spread_bps + k * participation^0.5
slippage_bps = min(slippage_bps, cap_bps)
```
默认参数：`half_spread_bps=5`, `k=20`, `cap_bps=50`（可配置）

---

## 3. 功能需求
### 3.1 数据层
- 数据源优先级：Tushare > NBS > Eastmoney > Akshare  
- 数据治理：清洗、对齐、版本化、数据血缘  
- `data/` 以文件为主，不强制入库  

### 3.2 模型层
- **宏观模型**：行业景气度/场景识别  
- **趋势模型**：市场状态识别 + 仓位建议  
- **主线/行业轮动**：板块强度/扩散/持续性  
- **选股排序**：横截面排名（**LGBM vs XGBoost** 对比），与规则选股兼容  
- **买卖点过滤**：规则 + 轻量模型  
- **LLM/NLP（可选）**：政策/产业/概念文本信号（主题/情绪/风险），输出结构化标签  
- **标签定义**：未来20日收益（中线），用于**回归排序**，**行业内rank**  

### 3.3 组合与风控
- 最大持仓数：10  
- 组合权重方式：等权  
- 单股最大权重：不设（可配置）  
- 单行业最大权重：40%  

### 3.4 策略层
- 多信号融合与策略编排  
- 组合构建与风控裁剪  

### 3.5 回测与评估
- Walk-forward/滚动回测  
- 支持手续费、滑点、复权  
- 输出标准化评估报告  

### 3.6 监控与报告
- 数据异常监控  
- 任务失败告警  
- 日报/周报输出  

---

## 4. 非功能需求
- 可复现性：配置+数据版本可追溯  
- 可扩展性：模块化接口  
- 可维护性：日志与脚本分模块  
- 安全性：Token/密钥不入库  
- 依赖管理：`requirements.txt` + `environment.yml`  
- 测试：`pytest` + TDD  
- 注释：代码英文注释，文档中文  
- LLM输出可追溯：记录模型版本、提示词、输入摘要与输出  

---

## 5. 约束
- Tushare IP/积分限制  
- 数据可能存在缺口  
- 实盘接口暂不优先（预留）  

---

## Q&A
- Q: 是否包含 A 股 ETF？  
  A: 可以包含（可配置）。
