# Sage股票智能交易平台选股排序模型模块设计文档

## 1. 模块定位
在给定股票池内进行横截面排序，输出候选股票排名。

---

## 2. 模型方向
- **LGBM vs XGBoost** 对比  
- 保留规则选股兼容（可单独运行规则打分）

---

## 3. 标签定义
- **多周期未来收益（20/60/120日）**  
- **行业内 rank**  
- 任务为**回归排序**（Learning to Rank）

## 3.1 特征清单（MVP v1）
来自 `RankModelLGBM.prepare_features()`：
- 动量类：`return_4d`, `return_12d`, `return_20d`
- 均线比：`ma_ratio_4d`, `ma_ratio_12d`, `ma_ratio_20d`
- 流动性：`turnover_4d_mean`, `turnover_4d_std`, `turnover_ratio_4d`
- 流动性：`turnover_12d_mean`, `turnover_12d_std`, `turnover_ratio_12d`
- 稳定性：`volatility_4d`, `volatility_12d`
- 价格波动：`price_std_4d`, `price_std_12d`
- 技术指标：`rsi_14`, `macd`, `macd_signal`, `bollinger_upper`, `bollinger_lower`

## 3.2 特征扩展（确认加入）
- 估值：`pe_ttm`, `pb`, `pe_percentile`, `pb_percentile`
- 质量：`roe`, `gross_margin`, `roic`
- 北向：`northbound_hold_ratio`, `northbound_net_flow`
- 行业动量：`industry_ret_4w`, `industry_ret_12w`

**完整计算规则详见**：`docs/2.21 Sage股票智能交易平台特征字典与计算规则.md`

---

## 4. 输入 / 输出
**输入**：
- 股票池：沪深300（历史成分）
- 特征：动量/质量/流动性/风险等

**输出**：
```json
{
  "date": "2026-02-13",
  "ranked": [
    {"ts_code": "600519.SH", "score": 0.92, "rank": 1}
  ]
}
```

**输出落地（建议）**：
- `data/signals/rank_score_<YYYYMMDD>.parquet`
- 字段：`trade_date/ts_code/rank_score/rank`

---

## 5. 评估指标
- RankIC / IC  
- TopK 命中率  
- 回测收益与回撤  

---

## 6. 与现有代码映射
- `ml_stock_forecast/models/rank_model.py`  

---

## Q&A
- Q: 是否引入更多因子（宏观/情绪）？  
  A: 目前要探索更多因子，我要看，设计文档里面内容太少看不出来
