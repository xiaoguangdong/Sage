# Sage股票智能交易平台数据治理与数据源适配模块设计文档

## 1. 模块定位
统一多数据源接入、字段规范、质量检查与版本管理，确保可复现性。

---

## 2. 数据源优先级
Tushare > NBS > Eastmoney > Akshare  
Baostock：可作为补充或备份。

---

## 3. 字段规范（必须统一）
- 股票代码：`ts_code`  
- 日期：`trade_date`（日频）/`date`（宏观月度）  
- 指数数据：`index_code`  

### 3.1 字段映射示例
| 来源字段 | 统一字段 |
|---|---|
| `code` / `stock` | `ts_code` |
| `date` / `trade_date` | `trade_date` |
| `close` | `close` |
| `amount` | `amount` |

---

## 4. 数据目录结构（建议）
```
data/
  raw/
    tushare/
    nbs/
    eastmoney/
  processed/
  features/
  metadata/
```

### 4.1 流程图（Mermaid）
```mermaid
flowchart LR
  A["原始数据"] --> B["清洗/对齐"]
  B --> C["字段映射统一"]
  C --> D["质量检查"]
  D --> E["processed/features输出"]
```

---

## 5. 数据质量检查
- 缺失值/重复值  
- 日期范围覆盖  
- 字段一致性  

---

## 6. 与现有代码映射
- `scripts/macro/*`
- `ml_stock_forecast/data/data_provider.py`
- `ml_stock_forecast/utils/data_loader.py`

---

## Q&A
- Q: 是否需要引入数据库（如DuckDB/SQLite）？  
  A: 暂不优先，先用文件+元数据。
