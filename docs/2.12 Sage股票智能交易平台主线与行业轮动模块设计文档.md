# Sage股票智能交易平台主线与行业轮动模块设计文档

## 1. 模块定位
识别市场“主线板块”和行业轮动节奏，为选股排序与信号融合提供**行业权重与趋势加成**。

---

## 2. 输入 / 输出
**输入**：
- 行业/概念指数（申万行业指数）
- 行业/概念成分股
- 资金/成交额/涨停强度（可选）

**输出**：
```json
{
  "date": "2026-02-13",
  "sector_scores": [
    {"industry": "新能源车", "score": 86, "label": "MAINLINE"}
  ]
}
```

**输出落地（建议）**：
- `data/signals/mainline_score_<YYYYMMDD>.parquet`
- 字段：`trade_date/industry/score/label`

---

## 3. 核心指标
1. **领涨强度**（相对指数收益）
2. **扩散速度**（上涨家数占比）
3. **持续性**（持续周数）
4. **兑现度**（财报或盈利支撑）
5. **拥挤度**（高换手/涨停占比，负向）

### 3.1 计算示意（简化）
```
leadership = Ret_industry_4w - Ret_index_4w
diffusion  = 上涨股票占比
persistence = 连续强势周数
crowding = 换手率/涨停比例
```

### 3.2 流程图（Mermaid）
```mermaid
flowchart LR
  A["行业/概念指数"] --> B["指标计算"]
  B --> C["得分汇总"]
  C --> D["主线标签/权重"]
```

---

## 4. 与现有代码映射
- `ml_stock_forecast/scripts/mainline_logic_system.py`
- `ml_stock_forecast/scripts/mainline_logic_system_optimized.py`

---

## 5. 应用规则
- 主线行业分数 TopN → 行业权重上调  
- 过热行业 → 风险提示（非直接剔除）  

---

## Q&A
- Q: 行业/概念数据来源优先级？  
  A: Tushare
