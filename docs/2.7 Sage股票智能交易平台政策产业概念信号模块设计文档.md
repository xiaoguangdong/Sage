# Sage股票智能交易平台政策产业概念信号模块设计文档

## 1. 模块定位
用于解析**政策/产业/概念**相关文本信息（公告、政策、行业研报），产出**行业级结构化信号**，作为**行业过滤与权重加成**依据。

> 当前实现以**规则+统计**为主，LLM 作为未来可选增强模块（不直接触发交易，仅影响权重或风险过滤）。

---

## 2. 输入与输出
**输入（已落地）**：
- 政府网站政策/公告（RSS/HTML 列表页）
- Tushare 公告（上市公司公告）
- 东方财富行业研报（行业级研报列表）
- 申万行业指数日线（行业动量）

**输入（规划中）**：
- 其他研报渠道（Wind/Choice/iFinD/慧博/券商平台）
- 概念板块/舆情（作为后续扩展）

**输出（已落地）**：
- `policy_signals.parquet`：行业级政策评分
- `policy_signals_enhanced.parquet`：在政策评分基础上融合研报与行业动量

输出字段（核心）：
- `trade_date`：信号日期  
- `sw_industry`：申万一级行业  
- `policy_score`：政策评分（0~1，规则抽取）  
- `doc_count`：文本条数  
- `source_weights`：来源加权和  
- `report_count_7d/30d`：研报热度  
- `rating_change_30d`：近30日评级上调-下调  
- `mom_20d/mom_60d`：行业指数动量  
- `vol_20d`：行业指数波动

---

## 3. 核心流程
1. **文本采集**：政府网站/公告/研报  
2. **预处理**：去重、时间对齐、行业映射  
3. **规则抽取**：行业关键词 + 情绪词打分  
4. **研报增强**：热度/评级变化统计  
5. **动量增强**：申万行业指数 20/60 日动量  
6. **输出**：政策信号 + 增强信号  

---

## 4. 信号使用规则
**用途**：
- 行业过滤（从候选中剔除弱行业）
- 权重微调（行业信号增强或削弱）
- 风险提示（过热/退潮）

**约束**：
- 不得单独触发交易  

---

## 5. 约束与风险
- **严禁前视**：必须使用**公告发布时间**  
- **可追溯**：保存模型版本、提示词、输入摘要  
- **可降级**：LLM不可用时自动跳过  

---

## 6. 与现有模块的接口
**输入**：
- `data/raw/policy/*`（政府网站/东方财富研报）
- `data/raw/tushare/policy/*`（Tushare 公告）
- `data/tushare/sectors/sw_daily_all.parquet`（行业指数）

**输出**：
- `data/processed/policy/policy_signals.parquet`
- `data/processed/policy/policy_signals_enhanced.parquet`

**融合**：
- `SignalOrchestrator` 读取行业信号，对行业权重做调整  

---

## 7. 配置建议（示意）
```yaml
policy_signal:
  enable_report_factors: true
  enable_industry_momentum: true
  report_weight: 0.2
  momentum_weight: 0.2
```

---

## 7.1 LLM 政策语义分析增强（最小可行设计）
**目标**：在规则版政策评分之上，补充结构化语义信号，用于“行业权重偏置/风险提示”，不直接触发交易。

**输入**：
- `title` / `content` / `source` / `publish_date`
- 规则版输出（`policy_score`）

**输出字段（建议）**：
- `llm_sentiment`：`{-1,0,1}`（负/中/正）
- `llm_intensity`：`0~1`（影响强度）
- `llm_horizon`：`{short,mid,long}`（影响周期）
- `llm_industry_tags`：`[sw_industry]`
- `llm_risk_flags`：`[risk_type]`（例如“产能过剩/监管趋严/去杠杆”）
- `llm_summary`：≤200字

**融合规则（示意）**：
```
final_policy_score = policy_score * (1 + llm_intensity * sentiment_weight)
if llm_risk_flags contains "监管趋严": down-weight
```

**降级策略**：
- LLM 不可用时只输出规则版结果
- 对无法解析行业的文本直接跳过

**合规与成本**：
- 缓存 `prompt_hash` + `model_version`
- 单条文本长度截断（如 4k tokens）

---

## 8. 测试策略
- 单元测试：输出字段完整性  
- 回测验证：行业轮动是否改善  
- 稳定性：不同年份覆盖率与可用性  

---

## Q&A
- Q: 当前研报主要来源？  
  A: 东方财富行业研报（行业级）为主，后续可扩展付费研报。
- Q: LLM 是否已接入？  
  A: 暂未接入，后续作为可选增强模块。
