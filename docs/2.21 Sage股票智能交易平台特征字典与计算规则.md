# Sage股票智能交易平台特征字典与计算规则

> 目标：统一特征定义与计算规则，避免口径不一致与数据泄露。

---

## 1. 通用字段规范
| 统一字段 | 含义 | 备注 |
|---|---|---|
| `ts_code` | 股票代码 | 统一用 `ts_code` |
| `trade_date` | 交易日 | 日频 |
| `date` | 日期 | 宏观月度/季度 |
| `close` | 收盘价 | 复权口径需一致 |
| `amount` | 成交额 | 用于滑点/流动性 |

---

## 2. 选股排序特征（RankModelLGBM）
### 2.1 动量类
- `return_4d = close / close.shift(4) - 1`
- `return_12d = close / close.shift(12) - 1`
- `return_20d = close / close.shift(20) - 1`

### 2.2 均线比
- `ma_ratio_4d = close / MA_4`
- `ma_ratio_12d = close / MA_12`
- `ma_ratio_20d = close / MA_20`

### 2.3 流动性
- `turnover_4d_mean = mean(turnover, 4)`
- `turnover_4d_std = std(turnover, 4)`
- `turnover_ratio_4d = turnover / turnover_4d_mean`
- `turnover_12d_mean = mean(turnover, 12)`
- `turnover_12d_std = std(turnover, 12)`
- `turnover_ratio_12d = turnover / turnover_12d_mean`

### 2.4 稳定性
- `volatility_4d = std(pct_change(close), 4)`
- `volatility_12d = std(pct_change(close), 12)`
- `price_std_4d = std(close, 4)`
- `price_std_12d = std(close, 12)`

### 2.5 技术指标
- `rsi_14`：RSI(14)
- `macd = EMA12(close) - EMA26(close)`
- `macd_signal = EMA9(macd)`
- `bollinger_upper = MA20 + 2*STD20`
- `bollinger_lower = MA20 - 2*STD20`

---

## 3. 趋势模型特征（MarketFeatures / TrendModel）
- `ma_20/ma_60/ma_120 = rolling_mean(close)`
- `ret_4w/ret_12w = close / close.shift(4/12周) - 1`
- `vol_4w/vol_12w = std(pct_change(close), 4/12周)`
- `price_rank_20d/60d = rolling percentile of close`
- `trend_strength = (ma_20 - ma_60) / ma_60`
- `vol_ratio = vol_4w / vol_12w`
- `extreme_vol_count = count(|ret| > 2*vol_12w, window=20)`
- `amt_trend_20d = mean(amount,20)/mean(amount,60)`
- `price_volume_corr = corr(pct_change(close), pct_change(amount), window=4)`
- `max_dd_20d = (rolling_max(close,20) - close) / rolling_max(close,20)`
- `drawdown_count = count(close < rolling_max*0.95, window=20)`
- `atr = mean(TrueRange,14)`

---

## 4. 宏观与行业特征
### 4.1 宏观
- `pmi`：制造业PMI
- `credit_growth`：社融同比增速
- `yield_10y`：10年期国债收益率
- `cpi_yoy / ppi_yoy`

### 4.2 行业
- `ppi_industry_yoy`
- `fai_yoy`
- `output_yoy`
- `rev_yoy`
- `pb_percentile`

---

## 5. 资金与北向特征
**当前采用市场级净流入**：
- `northbound_net_flow`（布林带突破信号，市场级）

> 不做行业配置比例版本（已确认）。

---

## 6. 行业动量特征
- `industry_ret_4w = industry_close / industry_close.shift(4w) - 1`
- `industry_ret_12w = industry_close / industry_close.shift(12w) - 1`

---

## 7. 标签定义（多周期）
```
future_return_h = close.shift(-h) / close - 1  # h in [20,60,120]
rank_label_h = future_return_h.rank(pct=True, group=industry)
```
**注意**：行业内rank；财报/公告/北向按T+2延迟。

---

## 8. 计算注意事项
- Rolling窗口需设置 `min_periods`
- 避免未来数据泄露
- 统一复权口径
